<!-- pages/trip-detail/trip-detail.wxml -->
<view class="page-container">
  <!-- æ—…è¡ŒåŸºæœ¬ä¿¡æ¯ -->
  <view class="card trip-info">
    <view class="trip-header">
      <text class="trip-name">{{ trip.name }}</text>
      <text class="trip-status {{ trip.status }}">{{ trip.status === 'created' ? 'æœªå¼€å§‹' : trip.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ' }} </text>
    </view>
  </view>
  <!-- åŠŸèƒ½å…¥å£ -->
  <view class="card actions-section" wx:if="{{ trip.status === 'ongoing' }}">
    <view class="action-grid">
      <view class="action-item" bindtap="addBill">
        <text class="action-icon">ğŸ’°</text>
        <text class="action-text">å¢åŠ è´¦å•</text>
      </view>
      <view class="action-item" bindtap="addMember">
        <text class="action-icon">â•</text>
        <text class="action-text">æ–°å¢æˆå‘˜</text>
      </view>
      <view class="action-item" bindtap="endTrip">
        <text class="action-icon">ğŸ</text>
        <text class="action-text">ç»“æŸæ—…è¡Œ</text>
      </view>
    </view>
  </view>
  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view class="card members-section">
    <view class="section-header">
      <text class="section-title">æˆå‘˜åˆ—è¡¨ {{ activeMembers.length }}äºº</text>
    </view>
    <view class="members-list">
      <view wx:for="{{ activeMembers }}" wx:key="id" class="member-item">
        <view class="member-avatar">
          <image wx:if="{{ item.avatarUrl }}" src="{{ item.avatarUrl }}" mode="aspectFill" />
          <view wx:else class="text-avatar">{{ item.initials }}</view>
        </view>
        <view class="member-info">
          <text class="member-name">{{ item.displayName }}</text>
          <text class="member-agent" wx:if="{{ item.agentMemberId }}"> ä»£ç†ï¼š{{ getMemberName(item.agentMemberId) }} </text>
        </view>
        <button class="btn-secondary" bindtap="setMemberAgent" data-member-id="{{ item.id }}" wx:if="{{ trip.status !== 'closed' }}">è®¾ä»£ç†</button>
      </view>
    </view>
  </view>
  <!-- æœ€è¿‘è´¦å• -->
  <view class="card bills-section" wx:if="{{ trip.status === 'ongoing' }}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘è´¦å•</text>
    </view>
    <view class="bills-list">
      <view wx:for="{{ recentBills }}" wx:key="_id" class="bill-item" bindtap="editBill" data-bill="{{ item }}">
        <view class="bill-header">
          <view class="bill-category {{ item.category }}"
            >{{
              item.category === 'food'
                ? 'é¤é¥®'
                : item.category === 'transport'
                ? 'äº¤é€š'
                : item.category === 'lodging'
                ? 'ä½å®¿'
                : item.category === 'ticket'
                ? 'é—¨ç¥¨'
                : 'å…¶ä»–'
            }}
          </view>
          <text class="bill-amount">{{ item.amount }}</text>
        </view>
        <view class="bill-info">
          <text class="bill-payer">{{ getMemberName(item.payerMemberId) }} æ”¯ä»˜</text>
          <text class="bill-date">{{ item.date }}</text>
        </view>
      </view>
      <view class="empty-bills" wx:if="{{ recentBills.length === 0 }}">
        <text>æš‚æ— è´¦å•è®°å½•</text>
      </view>
    </view>
  </view>
</view>
